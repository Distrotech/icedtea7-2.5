# HG changeset patch
# User hseigel
# Date 1401471163 14400
#      Fri May 30 13:32:43 2014 -0400
# Node ID 9664162a7109691191835f5d625daba3ce5f78a5
# Parent  e6b2c9c464d11d2b54d61c693d447f3cb8670663
8041717: Issue with class file parser
Summary: Add better checking for bad values.
Reviewed-by: coleenp, lfoltan, mschoene

diff -r e6b2c9c464d1 -r 9664162a7109 src/share/vm/classfile/classFileParser.cpp
--- openjdk/hotspot/src/share/vm/classfile/classFileParser.cpp	Mon Jun 16 10:23:46 2014 -0400
+++ openjdk/hotspot/src/share/vm/classfile/classFileParser.cpp	Fri May 30 13:32:43 2014 -0400
@@ -2826,6 +2826,11 @@
       "bootstrap_method_index %u has bad constant type in class file %s",
       bootstrap_method_index,
       CHECK);
+
+    guarantee_property((operand_fill_index + 1 + argument_count) < operands->length(),
+      "Invalid BootstrapMethods num_bootstrap_methods or num_bootstrap_arguments value in class file %s",
+      CHECK);
+
     operands->at_put(operand_fill_index++, bootstrap_method_index);
     operands->at_put(operand_fill_index++, argument_count);
 
@@ -2843,7 +2848,6 @@
   }
 
   assert(operand_fill_index == operands->length(), "exact fill");
-  assert(ConstantPool::operand_array_length(operands) == attribute_array_length, "correct decode");
 
   u1* current_end = cfs->current();
   guarantee_property(current_end == current_start + attribute_byte_length,
